<!DOCTYPE html>
<html ng-app="posties" ng-controller="{{angular_controller}}" ng-style="{'background': userSettings.pagebackgroundcolor}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Posti.es</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="description" content="Posti.es, instant one page website creator">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="{{ asset_url_for('favicon', 'ico', false) }}" type="image/png">
    <link rel="shortcut icon" type="image/png" href="{{ asset_url_for('favicon', 'ico', false) }}">
    <link rel="stylesheet" href="{{ asset_url_for('posties', 'css') }}">
  </head>
  <body class="site">
    {% include 'modules/header.html' %}

    <div class="site-container" ng-controller="EditorCtrl">
      {% if user_owns_page %}
        {% include 'modules/welcome.html' %}
      {% endif %}

      <ul id="posts" ng-style="{ 'color': userSettings.posttextcolor }">
        <li ng-repeat="post in posts" data-id="[[post.id]]" data-rank="[[post.sortrank]]" class="post">
          <ng-include src="post.template"></ng-include>
        </li>
      </ul>

      {% if is_start_page or user_owns_page %}
        {% include 'modules/postTypes.html' %}
      {% endif %}

      {% if is_start_page %}
        {% include 'modules/signup.html' %}
      {% endif %}
    </div>

    {% if is_start_page or user_owns_page %}
      {% include 'modules/jsTemplates/postTextAuthenticated.html' %}
      {% include 'modules/jsTemplates/postHeadlineAuthenticated.html' %}
      {% include 'modules/jsTemplates/postImageAuthenticated.html' %}
      {% include 'modules/jsTemplates/postVideoAuthenticated.html' %}
    {% else %}
      {% include 'modules/jsTemplates/postText.html' %}
      {% include 'modules/jsTemplates/postHeadline.html' %}
      {% include 'modules/jsTemplates/postImage.html' %}
      {% include 'modules/jsTemplates/postVideo.html' %}
    {% endif %}

    {% include 'modules/svgSprite.html' %}

    <script>
      var FONTS = [{% for font in fonts %}'{{font}}'{% if not loop.last %}, {% endif %}{% endfor %}];
      var USER_DATA = {% if user_data %}{{ user_data|tojson|safe }}{% else %}false{% endif %};

      // Trigger svg redraw (safari issue)
      document.addEventListener('DOMContentLoaded', function(){
        var elms = document.getElementsByTagName('use');
        Array.prototype.forEach.call(elms, function(el, i){
          var href = el.getAttribute('xlink:href');
          el.setAttribute('xlink:href', href);
        });
      });

      // Google analytics
      {% if config.in_production %}
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-50858987-1', 'auto');
        ga('require', 'displayfeatures');
      {% endif %}
    </script>

    <script src="//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js"></script>
    <script src="{{ asset_url_for('posties', 'js') }}"></script>
    {% if is_start_page or user_owns_page %}
    <script src="//api.filepicker.io/v1/filepicker.js"></script>
    <script>filepicker.setKey('{{filepicker_key}}');</script>
    {% endif %}
  </body>
</html>
